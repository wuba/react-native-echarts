Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@0no-co/graphql.web"),r=require("./urql-core-chunk.min.js"),t=require("wonka"),n=(e,r)=>{if(Array.isArray(e))for(var t of e)n(t,r);else if("object"==typeof e&&null!==e)for(var a in e)"__typename"===a&&"string"==typeof e[a]?r.add(e[a]):n(e[a],r);return r},a=r=>{var t=!1;if("definitions"in r){var n=[];for(var o of r.definitions){var i=a(o);t=t||i!==o,n.push(i)}if(t)return{...r,definitions:n}}else if("selectionSet"in r){var s=[],u=r.kind===e.Kind.OPERATION_DEFINITION;if(r.selectionSet){for(var c of r.selectionSet.selections||[]){u=u||c.kind===e.Kind.FIELD&&"__typename"===c.name.value&&!c.alias;var p=a(c);t=t||p!==c,s.push(p)}if(u||(t=!0,s.push({kind:e.Kind.FIELD,name:{kind:e.Kind.NAME,value:"__typename"}})),t)return{...r,selectionSet:{...r.selectionSet,selections:s}}}}return r},o=new Map,i=e=>{var t=r.keyDocument(e),n=o.get(t.__key);return n||(o.set(t.__key,n=a(t)),Object.defineProperty(n,"__key",{value:t.__key,enumerable:!1})),n},s=(e,r)=>{if(e&&"object"==typeof e){if(Array.isArray(e))return e.map((e=>s(e)));if(e&&"object"==typeof e&&(r||"__typename"in e)){var t={};for(var n in e)"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:e.__typename}):t[n]=s(e[n]);return t}return e}return e};function u(e,r,t){return{...r,kind:e,context:r.context?{...r.context,...t}:t||r.context}}var c=()=>{},p=({kind:e})=>"mutation"!==e&&"query"!==e,l=(e,r)=>e.reexecuteOperation(u(r.kind,r,{requestPolicy:"network-only"})),d=new Set,f=e=>({client:r,forward:n})=>e.reduceRight(((e,n)=>n({client:r,forward:r=>t.share(e(t.share(r))),dispatchDebug(e){}})),n),k=({onOperation:e,onResult:r,onError:n})=>({forward:a})=>o=>t.mergeMap((e=>{n&&e.error&&n(e.error,e.operation);var a=r&&r(e)||e;return"then"in a?t.fromPromise(a):t.fromValue(a)}))(a(t.mergeMap((r=>{var n=e&&e(r)||r;return"then"in n?t.fromPromise(n):t.fromValue(n)}))(o))),y=({})=>e=>t.filter((e=>!1))(e),m=function e(n){var a=0,o=new Map,i=new Map,p=new Set,l=[],d={url:n.url,fetchOptions:n.fetchOptions,fetch:n.fetch,preferGetMethod:!!n.preferGetMethod,requestPolicy:n.requestPolicy||"cache-first"},k=t.makeSubject();function m(e){"mutation"!==e.kind&&"teardown"!==e.kind&&p.has(e.key)||("teardown"===e.kind?p.delete(e.key):"mutation"!==e.kind&&p.add(e.key),k.next(e))}var h=!1;function x(e){if(e&&m(e),!h){for(h=!0;h&&(e=l.shift());)m(e);h=!1}}var v=e=>{var r=t.takeUntil(t.filter((r=>"teardown"===r.kind&&r.key===e.key))(k.source))(t.filter((r=>r.operation.kind===e.kind&&r.operation.key===e.key&&(!r.operation.context._instance||r.operation.context._instance===e.context._instance)))(E));return r="query"!==e.kind?t.takeWhile((e=>!!e.hasNext),!0)(r):t.switchMap((r=>{var n=t.fromValue(r);return r.stale||r.hasNext?n:t.merge([n,t.map((()=>(r.stale=!0,r)))(t.take(1)(t.filter((r=>r.key===e.key))(k.source)))])}))(r),r="mutation"!==e.kind?t.onEnd((()=>{p.delete(e.key),o.delete(e.key),i.delete(e.key),h=!1;for(var r=l.length-1;r>=0;r--)l[r].key===e.key&&l.splice(r,1);m(u("teardown",e,e.context))}))(t.onPush((r=>{if(r.stale){for(var t of l)if(t.key===r.operation.key){p.delete(t.key);break}}else r.hasNext||p.delete(e.key);o.set(e.key,r)}))(r)):t.onStart((()=>{m(e)}))(r),n.maskTypename&&(r=t.map((e=>({...e,data:s(e.data,!0)})))(r)),t.share(r)},g=this instanceof e?this:Object.create(e.prototype),b=Object.assign(g,{suspense:!!n.suspense,operations$:k.source,reexecuteOperation(e){"teardown"===e.kind?x(e):("mutation"===e.kind||i.has(e.key))&&(l.push(e),Promise.resolve().then(x))},createRequestOperation:(e,r,t)=>(t||(t={}),u(e,r,{_instance:"mutation"===e?a=a+1|0:void 0,...d,...t,requestPolicy:t.requestPolicy||d.requestPolicy,suspense:t.suspense||!1!==t.suspense&&b.suspense})),executeRequestOperation:e=>{return r="mutation"===e.kind?v(e):t.lazy((()=>{var r=i.get(e.key);r||i.set(e.key,r=v(e)),r=t.onStart((()=>{x(e)}))(r);var n=o.get(e.key);return"query"===e.kind&&n&&(n.stale||n.hasNext)?t.switchMap(t.fromValue)(t.merge([r,t.filter((r=>r===o.get(e.key)))(t.fromValue(n))])):r})),(n=e=>r(e)).toPromise=()=>t.toPromise(t.take(1)(t.filter((e=>!e.stale&&!e.hasNext))(n))),n.then=(e,r)=>n.toPromise().then(e,r),n.subscribe=e=>t.subscribe(e)(n),n;var r,n},executeQuery(e,r){var t=b.createRequestOperation("query",e,r);return b.executeRequestOperation(t)},executeSubscription(e,r){var t=b.createRequestOperation("subscription",e,r);return b.executeRequestOperation(t)},executeMutation(e,r){var t=b.createRequestOperation("mutation",e,r);return b.executeRequestOperation(t)},readQuery(e,r,n){var a=null;return t.subscribe((e=>{a=e}))(b.query(e,r,n)).unsubscribe(),a},query:(e,t,n)=>b.executeQuery(r.createRequest(e,t),n),subscription:(e,t,n)=>b.executeSubscription(r.createRequest(e,t),n),mutation:(e,t,n)=>b.executeMutation(r.createRequest(e,t),n)}),w=c,q=f(n.exchanges),E=t.share(q({client:b,dispatchDebug:w,forward:y({dispatchDebug:w})})(k.source));return t.publish(E),b},h=m;exports.CombinedError=r.CombinedError,exports.createRequest=r.createRequest,exports.makeErrorResult=r.makeErrorResult,exports.makeResult=r.makeResult,exports.mergeResultPatch=r.mergeResultPatch,exports.stringifyDocument=r.stringifyDocument,exports.stringifyVariables=r.stringifyVariables,exports.Client=m,exports.cacheExchange=({forward:e,client:r})=>{var a=new Map,o=new Map,s=e=>{var r=u(e.kind,e);return r.query=i(e.query),r},c=e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy&&("cache-only"===e.context.requestPolicy||a.has(e.key));return i=>{var u=t.map((e=>{var t=a.get(e.key);return"cache-and-network"===e.context.requestPolicy&&(t.stale=!0,l(r,e)),t}))(t.filter((e=>!p(e)&&c(e)))(i)),d=t.tap((e=>{var{operation:t}=e;if(t){var i=(e=>[...n(e,new Set)])(e.data).concat(t.context.additionalTypenames||[]);if("mutation"===e.operation.kind){for(var s=new Set,u=0;u<i.length;u++){var c=i[u],p=o.get(c);for(var d of(p||o.set(c,p=new Set),p.values()))s.add(d);p.clear()}for(var f of s.values())a.has(f)&&(t=a.get(f).operation,a.delete(f),l(r,t))}else if("query"===t.kind&&e.data){a.set(t.key,e);for(var k=0;k<i.length;k++){var y=i[k],m=o.get(y);m||o.set(y,m=new Set),m.add(t.key)}}}}))(e(t.filter((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(t.map((e=>e))(t.merge([t.map(s)(t.filter((e=>!p(e)&&!c(e)))(i)),t.filter((e=>p(e)))(i)])))));return t.merge([u,d])}},exports.composeExchanges=f,exports.createClient=h,exports.debugExchange=({forward:e})=>r=>e(r),exports.dedupExchange=({forward:e})=>r=>e(r),exports.errorExchange=k,exports.fetchExchange=({forward:e})=>n=>{var a=t.mergeMap((e=>{var a=r.makeFetchBody(e),o=r.makeFetchURL(e,a),i=r.makeFetchOptions(e,a);return t.takeUntil(t.filter((r=>"teardown"===r.kind&&r.key===e.key))(n))(r.makeFetchSource(e,o,i))}))(t.filter((e=>"teardown"!==e.kind&&("subscription"!==e.kind||!!e.context.fetchSubscriptions)))(n)),o=e(t.filter((e=>"teardown"===e.kind||"subscription"===e.kind&&!e.context.fetchSubscriptions))(n));return t.merge([a,o])},exports.formatDocument=i,exports.gql=function(t){for(var n=new Map,a=[],o=[],i=Array.isArray(t)?t[0]:t||"",s=1;s<arguments.length;s++){var u=arguments[s];u&&u.definitions?o.push(u):i+=u,i+=arguments[0][s]}for(var c of(o.unshift(r.keyDocument(i)),o))for(var p of c.definitions)if(p.kind===e.Kind.FRAGMENT_DEFINITION){var l=p.name.value,d=r.stringifyDocument(p);n.has(l)||(n.set(l,d),a.push(p))}else a.push(p);return r.keyDocument({kind:e.Kind.DOCUMENT,definitions:a})},exports.makeOperation=u,exports.mapExchange=k,exports.maskTypename=s,exports.ssrExchange=(e={})=>{var n=!!e.staleWhileRevalidate,a=!!e.includeExtensions,o={},i=[],s=e=>{i.push(e.operation.key),1===i.length&&Promise.resolve().then((()=>{for(var e;e=i.shift();)o[e]=null}))},u=({client:i,forward:u})=>c=>{var p=e&&"boolean"==typeof e.isClient?!!e.isClient:!i.suspense,f=u(t.filter((e=>!o[e.key]||!!o[e.key].hasNext||"network-only"===e.context.requestPolicy))(c)),k=t.map((e=>{var t=((e,t,n)=>({operation:e,data:t.data?JSON.parse(t.data):void 0,extensions:n&&t.extensions?JSON.parse(t.extensions):void 0,error:t.error?new r.CombinedError({networkError:t.error.networkError?new Error(t.error.networkError):void 0,graphQLErrors:t.error.graphQLErrors}):void 0,stale:!1,hasNext:!!t.hasNext}))(e,o[e.key],a);return n&&!d.has(e.key)&&(t.stale=!0,d.add(e.key),l(i,e)),{...t,operation:e}}))(t.filter((e=>!!o[e.key]&&"network-only"!==e.context.requestPolicy))(c));return p?k=t.tap(s)(k):f=t.tap((e=>{var{operation:r}=e;if("mutation"!==r.kind){var t=((e,r)=>{var t={data:JSON.stringify(e.data),hasNext:e.hasNext};return void 0!==e.data&&(t.data=JSON.stringify(e.data)),r&&void 0!==e.extensions&&(t.extensions=JSON.stringify(e.extensions)),e.error&&(t.error={graphQLErrors:e.error.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},e.error.networkError&&(t.error.networkError=""+e.error.networkError)),t})(e,a);o[r.key]=t}}))(f),t.merge([f,k])};return u.restoreData=e=>{for(var r in e)null!==o[r]&&(o[r]=e[r])},u.extractData=()=>{var e={};for(var r in o)null!=o[r]&&(e[r]=o[r]);return e},e&&e.initialState&&u.restoreData(e.initialState),u},exports.subscriptionExchange=({forwardSubscription:e,enableAllOperations:n,isSubscriptionOperation:a})=>({client:o,forward:i})=>{var s=a||(e=>{var{kind:r}=e;return"subscription"===r||!!n&&("query"===r||"mutation"===r)});return n=>{var a=t.mergeMap((a=>{var{key:i}=a,s=t.filter((e=>"teardown"===e.kind&&e.key===i))(n);return t.takeUntil(s)((n=>{var a=e(r.makeFetchBody(n),n);return t.make((({next:e,complete:t})=>{var i,s,c=!1;return Promise.resolve().then((()=>{c||(i=a.subscribe({next(t){e(s=s?r.mergeResultPatch(s,t):r.makeResult(n,t))},error(t){e(r.makeErrorResult(n,t))},complete(){c||(c=!0,"subscription"===n.kind&&o.reexecuteOperation(u("teardown",n,n.context)),s&&s.hasNext&&e(r.mergeResultPatch(s,{hasNext:!1})),t())}}))})),()=>{c=!0,i&&i.unsubscribe()}}))})(a))}))(t.filter(s)(n)),c=i(t.filter((e=>!s(e)))(n));return t.merge([a,c])}};
//# sourceMappingURL=urql-core.min.js.map
