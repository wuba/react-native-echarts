import{Kind as e}from"@0no-co/graphql.web";import{k as r,s as t,C as n,m as a,a as o,b as s,c as u,d as c,e as d,f as p,g as y,h as l}from"./urql-core-chunk.min.mjs";export{i as stringifyVariables}from"./urql-core-chunk.min.mjs";import{toPromise as k,take as f,filter as v,subscribe as h,map as x,tap as m,merge as w,mergeMap as b,takeUntil as q,make as g,onPush as O,share as _,fromPromise as N,fromValue as S,makeSubject as E,lazy as P,onStart as M,switchMap as R,publish as D,takeWhile as A,onEnd as j}from"wonka";var I=(e,r)=>{if(Array.isArray(e))for(var t of e)I(t,r);else if("object"==typeof e&&null!==e)for(var n in e)"__typename"===n&&"string"==typeof e[n]?r.add(e[n]):I(e[n],r);return r},Q=r=>{var t=!1;if("definitions"in r){var n=[];for(var a of r.definitions){var o=Q(a);t=t||o!==a,n.push(o)}if(t)return{...r,definitions:n}}else if("selectionSet"in r){var i=[],s=r.kind===e.OPERATION_DEFINITION;if(r.selectionSet){for(var u of r.selectionSet.selections||[]){s=s||u.kind===e.FIELD&&"__typename"===u.name.value&&!u.alias;var c=Q(u);t=t||c!==u,i.push(c)}if(s||(t=!0,i.push({kind:e.FIELD,name:{kind:e.NAME,value:"__typename"}})),t)return{...r,selectionSet:{...r.selectionSet,selections:i}}}}return r},T=new Map,L=e=>{var t=r(e),n=T.get(t.__key);return n||(T.set(t.__key,n=Q(t)),Object.defineProperty(n,"__key",{value:t.__key,enumerable:!1})),n},F=(e,r)=>{if(e&&"object"==typeof e){if(Array.isArray(e))return e.map((e=>F(e)));if(e&&"object"==typeof e&&(r||"__typename"in e)){var t={};for(var n in e)"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:e.__typename}):t[n]=F(e[n]);return t}return e}return e};function J(e,r,t){return{...r,kind:e,context:r.context?{...r.context,...t}:t||r.context}}var C=()=>{};function G(n){for(var a=new Map,o=[],i=[],s=Array.isArray(n)?n[0]:n||"",u=1;u<arguments.length;u++){var c=arguments[u];c&&c.definitions?i.push(c):s+=c,s+=arguments[0][u]}for(var d of(i.unshift(r(s)),i))for(var p of d.definitions)if(p.kind===e.FRAGMENT_DEFINITION){var y=p.name.value,l=t(p);a.has(y)||(a.set(y,l),o.push(p))}else o.push(p);return r({kind:e.DOCUMENT,definitions:o})}var U=({kind:e})=>"mutation"!==e&&"query"!==e,V=({forward:e,client:r})=>{var t=new Map,n=new Map,a=e=>{var r=J(e.kind,e);return r.query=L(e.query),r},o=e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy&&("cache-only"===e.context.requestPolicy||t.has(e.key));return i=>{var s=x((e=>{var n=t.get(e.key);return"cache-and-network"===e.context.requestPolicy&&(n.stale=!0,W(r,e)),n}))(v((e=>!U(e)&&o(e)))(i)),u=m((e=>{var{operation:a}=e;if(a){var o=(e=>[...I(e,new Set)])(e.data).concat(a.context.additionalTypenames||[]);if("mutation"===e.operation.kind){for(var i=new Set,s=0;s<o.length;s++){var u=o[s],c=n.get(u);for(var d of(c||n.set(u,c=new Set),c.values()))i.add(d);c.clear()}for(var p of i.values())t.has(p)&&(a=t.get(p).operation,t.delete(p),W(r,a))}else if("query"===a.kind&&e.data){t.set(a.key,e);for(var y=0;y<o.length;y++){var l=o[y],k=n.get(l);k||n.set(l,k=new Set),k.add(a.key)}}}}))(e(v((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(x((e=>e))(w([x(a)(v((e=>!U(e)&&!o(e)))(i)),v((e=>U(e)))(i)])))));return w([s,u])}},W=(e,r)=>e.reexecuteOperation(J(r.kind,r,{requestPolicy:"network-only"})),$=new Set,z=(e={})=>{var r=!!e.staleWhileRevalidate,t=!!e.includeExtensions,a={},o=[],i=e=>{o.push(e.operation.key),1===o.length&&Promise.resolve().then((()=>{for(var e;e=o.shift();)a[e]=null}))},s=({client:o,forward:s})=>u=>{var c=e&&"boolean"==typeof e.isClient?!!e.isClient:!o.suspense,d=s(v((e=>!a[e.key]||!!a[e.key].hasNext||"network-only"===e.context.requestPolicy))(u)),p=x((e=>{var i=((e,r,t)=>({operation:e,data:r.data?JSON.parse(r.data):void 0,extensions:t&&r.extensions?JSON.parse(r.extensions):void 0,error:r.error?new n({networkError:r.error.networkError?new Error(r.error.networkError):void 0,graphQLErrors:r.error.graphQLErrors}):void 0,stale:!1,hasNext:!!r.hasNext}))(e,a[e.key],t);return r&&!$.has(e.key)&&(i.stale=!0,$.add(e.key),W(o,e)),{...i,operation:e}}))(v((e=>!!a[e.key]&&"network-only"!==e.context.requestPolicy))(u));return c?p=m(i)(p):d=m((e=>{var{operation:r}=e;if("mutation"!==r.kind){var n=((e,r)=>{var t={data:JSON.stringify(e.data),hasNext:e.hasNext};return void 0!==e.data&&(t.data=JSON.stringify(e.data)),r&&void 0!==e.extensions&&(t.extensions=JSON.stringify(e.extensions)),e.error&&(t.error={graphQLErrors:e.error.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},e.error.networkError&&(t.error.networkError=""+e.error.networkError)),t})(e,t);a[r.key]=n}}))(d),w([d,p])};return s.restoreData=e=>{for(var r in e)null!==a[r]&&(a[r]=e[r])},s.extractData=()=>{var e={};for(var r in a)null!=a[r]&&(e[r]=a[r]);return e},e&&e.initialState&&s.restoreData(e.initialState),s},B=({forwardSubscription:e,enableAllOperations:r,isSubscriptionOperation:t})=>({client:n,forward:i})=>{var c=t||(e=>{var{kind:t}=e;return"subscription"===t||!!r&&("query"===t||"mutation"===t)});return r=>{var t=b((t=>{var{key:i}=t,c=v((e=>"teardown"===e.kind&&e.key===i))(r);return q(c)((r=>{var t=e(a(r),r);return g((({next:e,complete:a})=>{var i,c,d=!1;return Promise.resolve().then((()=>{d||(i=t.subscribe({next(t){e(c=c?o(c,t):s(r,t))},error(t){e(u(r,t))},complete(){d||(d=!0,"subscription"===r.kind&&n.reexecuteOperation(J("teardown",r,r.context)),c&&c.hasNext&&e(o(c,{hasNext:!1})),a())}}))})),()=>{d=!0,i&&i.unsubscribe()}}))})(t))}))(v(c)(r)),d=i(v((e=>!c(e)))(r));return w([t,d])}},H=({forward:e})=>r=>e(r),K=({forward:e})=>r=>e(r),X=({forward:e})=>r=>{var t=b((e=>{var t=a(e),n=c(e,t),o=d(e,t);return q(v((r=>"teardown"===r.kind&&r.key===e.key))(r))(p(e,n,o))}))(v((e=>"teardown"!==e.kind&&("subscription"!==e.kind||!!e.context.fetchSubscriptions)))(r)),n=e(v((e=>"teardown"===e.kind||"subscription"===e.kind&&!e.context.fetchSubscriptions))(r));return w([t,n])},Y=e=>({client:r,forward:t})=>e.reduceRight(((e,t)=>t({client:r,forward:r=>_(e(_(r))),dispatchDebug(e){}})),t),Z=({onOperation:e,onResult:r,onError:t})=>({forward:n})=>a=>b((e=>{t&&e.error&&t(e.error,e.operation);var n=r&&r(e)||e;return"then"in n?N(n):S(n)}))(n(b((r=>{var t=e&&e(r)||r;return"then"in t?N(t):S(t)}))(a))),ee=({})=>e=>v((e=>!1))(e),re=function e(r){var t=0,n=new Map,a=new Map,o=new Set,i=[],s={url:r.url,fetchOptions:r.fetchOptions,fetch:r.fetch,preferGetMethod:!!r.preferGetMethod,requestPolicy:r.requestPolicy||"cache-first"},u=E();function c(e){"mutation"!==e.kind&&"teardown"!==e.kind&&o.has(e.key)||("teardown"===e.kind?o.delete(e.key):"mutation"!==e.kind&&o.add(e.key),u.next(e))}var d=!1;function p(e){if(e&&c(e),!d){for(d=!0;d&&(e=i.shift());)c(e);d=!1}}var y=e=>{var t=q(v((r=>"teardown"===r.kind&&r.key===e.key))(u.source))(v((r=>r.operation.kind===e.kind&&r.operation.key===e.key&&(!r.operation.context._instance||r.operation.context._instance===e.context._instance)))(I));return t="query"!==e.kind?A((e=>!!e.hasNext),!0)(t):R((r=>{var t=S(r);return r.stale||r.hasNext?t:w([t,x((()=>(r.stale=!0,r)))(f(1)(v((r=>r.key===e.key))(u.source)))])}))(t),t="mutation"!==e.kind?j((()=>{o.delete(e.key),n.delete(e.key),a.delete(e.key),d=!1;for(var r=i.length-1;r>=0;r--)i[r].key===e.key&&i.splice(r,1);c(J("teardown",e,e.context))}))(O((r=>{if(r.stale){for(var t of i)if(t.key===r.operation.key){o.delete(t.key);break}}else r.hasNext||o.delete(e.key);n.set(e.key,r)}))(t)):M((()=>{c(e)}))(t),r.maskTypename&&(t=x((e=>({...e,data:F(e.data,!0)})))(t)),_(t)},m=this instanceof e?this:Object.create(e.prototype),b=Object.assign(m,{suspense:!!r.suspense,operations$:u.source,reexecuteOperation(e){"teardown"===e.kind?p(e):("mutation"===e.kind||a.has(e.key))&&(i.push(e),Promise.resolve().then(p))},createRequestOperation:(e,r,n)=>(n||(n={}),J(e,r,{_instance:"mutation"===e?t=t+1|0:void 0,...s,...n,requestPolicy:n.requestPolicy||s.requestPolicy,suspense:n.suspense||!1!==n.suspense&&b.suspense})),executeRequestOperation:e=>{return r="mutation"===e.kind?y(e):P((()=>{var r=a.get(e.key);r||a.set(e.key,r=y(e)),r=M((()=>{p(e)}))(r);var t=n.get(e.key);return"query"===e.kind&&t&&(t.stale||t.hasNext)?R(S)(w([r,v((r=>r===n.get(e.key)))(S(t))])):r})),(t=e=>r(e)).toPromise=()=>k(f(1)(v((e=>!e.stale&&!e.hasNext))(t))),t.then=(e,r)=>t.toPromise().then(e,r),t.subscribe=e=>h(e)(t),t;var r,t},executeQuery(e,r){var t=b.createRequestOperation("query",e,r);return b.executeRequestOperation(t)},executeSubscription(e,r){var t=b.createRequestOperation("subscription",e,r);return b.executeRequestOperation(t)},executeMutation(e,r){var t=b.createRequestOperation("mutation",e,r);return b.executeRequestOperation(t)},readQuery(e,r,t){var n=null;return h((e=>{n=e}))(b.query(e,r,t)).unsubscribe(),n},query:(e,r,t)=>b.executeQuery(l(e,r),t),subscription:(e,r,t)=>b.executeSubscription(l(e,r),t),mutation:(e,r,t)=>b.executeMutation(l(e,r),t)}),g=C,N=Y(r.exchanges),I=_(N({client:b,dispatchDebug:g,forward:ee({dispatchDebug:g})})(u.source));return D(I),b},te=re;export{re as Client,n as CombinedError,V as cacheExchange,Y as composeExchanges,te as createClient,l as createRequest,H as debugExchange,K as dedupExchange,Z as errorExchange,X as fetchExchange,L as formatDocument,G as gql,u as makeErrorResult,J as makeOperation,s as makeResult,Z as mapExchange,F as maskTypename,o as mergeResultPatch,z as ssrExchange,t as stringifyDocument,B as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
